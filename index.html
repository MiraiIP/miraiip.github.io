<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ VPN-–ø–æ–¥–ø–∏—Å–∫–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 24px;
      text-align: center;
    }
    a {
      word-break: break-all;
      font-size: 16px;
    }
  </style>
</head>
<body>

<h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ VPN-–ø–æ–¥–ø–∏—Å–∫–∏‚Ä¶</h3>

<p id="fallback-text" style="display:none;">
  –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–∞–∂–º–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ:
</p>

<p>
  <a id="fallback-link" href="#" style="display:none;">
    –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
  </a>
</p>

<p id="store-link" style="display:none;">
  <a id="store-url" href="#">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</a>
</p>

<script>
  const params = new URLSearchParams(window.location.search);
  const app = params.get("app");
  const key = params.get("key");

  if (!app || !key) {
    document.body.innerHTML =
      "<h3>–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞</h3><p>–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>";
    throw new Error("Missing params");
  }

  // üîê URL –ø–æ–¥–ø–∏—Å–∫–∏ Marzban
  const subUrl = "https://pr01.crol-dark.tech/sub/" + key;

  let deepLink = null;
  let storeLink = null;

  // routing –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Happ
  const happRouting = "ewogICAgIkJsb2NrSXAiOiBbCiAgICBdLAogICAgIkJsb2NrU2l0ZXMiOiBbCiAgICBdLAogICAgIkRpcmVjdElwIjogWwogICAgXSwKICAgICJEaXJlY3RTaXRlcyI6IFsKICAgIF0sCiAgICAiRG5zSG9zdHMiOiB7CiAgICAgICAgImRucy5hZGd1YXJkLWRucy5jb20iOiAiOTQuMTQwLjE0LjE0IgogICAgfSwKICAgICJEb21haW5TdHJhdGVneSI6ICJJUElmTm9uTWF0Y2giLAogICAgIkRvbWVzdGljRE5TRG9tYWluIjogImh0dHBzOi8vZG5zLmFkZ3VhcmQtZG5zLmNvbS9kbnMtcXVlcnkiLAogICAgIkRvbWVzdGljRE5TSVAiOiAiOTQuMTQwLjE1LjE1IiwKICAgICJEb21lc3RpY0ROU1R5cGUiOiAiRG9IIiwKICAgICJGYWtlRE5TIjogImZhbHNlIiwKICAgICJHZW9pcHVybCI6ICJodHRwczovL2dpdGh1Yi5jb20vZnJheVpWL3NpbXBsZS1ydS1nZW9pcC9yZWxlYXNlcy9sYXRlc3QvZG93bmxvYWQvZ2VvaXAuZGF0IiwKICAgICJHZW9zaXRldXJsIjogImh0dHBzOi8vZ2l0aHViLmNvbS9mcmF5WlYvc2ltcGxlLXJ1LWdlb3NpdGUvcmVsZWFzZXMvbGF0ZXN0L2Rvd25sb2FkL2dlb3NpdGUuZGF0IiwKICAgICJHbG9iYWxQcm94eSI6ICJ0cnVlIiwKICAgICJMYXN0VXBkYXRlZCI6ICIxNzY3MzgyOTQyIiwKICAgICJOYW1lIjogIlJheSBWUE4gTWFpbiIsCiAgICAiUHJveHlJcCI6IFsKICAgIF0sCiAgICAiUHJveHlTaXRlcyI6IFsKICAgIF0sCiAgICAiUmVtb3RlRE5TRG9tYWluIjogImh0dHBzOi8vZG5zLmFkZ3VhcmQtZG5zLmNvbS9kbnMtcXVlcnkiLAogICAgIlJlbW90ZUROU0lQIjogIjk0LjE0MC4xNC4xNCIsCiAgICAiUmVtb3RlRE5TVHlwZSI6ICJEb0giCn0=";

  switch(app) {
    case "happ":
      // —Å–Ω–∞—á–∞–ª–∞ routing
      deepLink = "happ://routing/add/" + happRouting;
      // –ø–æ—Ç–æ–º –ø–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç
      setTimeout(() => {
        location.href = "happ://add/" + encodeURIComponent(subUrl);
      }, 800);
      // —Å—Å—ã–ª–∫–∞ –≤ Store
      storeLink = /iphone|ipad/i.test(navigator.userAgent)
        ? "https://apps.apple.com/app/id6444312432"
        : "https://play.google.com/store/apps/details?id=app.hiddify.com";
      break;

    case "hiddify":
      deepLink = subUrl; // —á–∏—Å—Ç—ã–π HTTPS
      storeLink =
        /iphone|ipad/i.test(navigator.userAgent)
        ? "https://apps.apple.com/app/id6444077591"
        : "https://play.google.com/store/apps/details?id=app.hiddify.com";
      break;

    case "singbox":
      deepLink = "sing-box://import-remote-profile?url=" + encodeURIComponent(subUrl);
      storeLink = "https://apps.apple.com/app/id6451272673";
      break;

    case "streisand":
      deepLink = "streisand://import?url=" + encodeURIComponent(subUrl);
      storeLink = "https://apps.apple.com/app/id6450534064";
      break;

    case "v2raytun":
      deepLink = "v2raytun://import/sub?url=" + encodeURIComponent(subUrl);
      storeLink = "https://play.google.com/store/apps/details?id=com.v2raytun.android";
      break;

    case "v2box":
      deepLink = "v2box://add-profile?url=" + encodeURIComponent(subUrl);
      storeLink = "https://apps.apple.com/app/id6446819692";
      break;

    default:
      document.body.innerHTML = "<h3>–û—à–∏–±–∫–∞: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>";
      throw new Error("Unknown app");
  }

  // fallback UI ‚Äî –í–°–ï–ì–î–ê —á–∏—Å—Ç—ã–π HTTPS
  const fallbackText = document.getElementById("fallback-text");
  const fallbackLink = document.getElementById("fallback-link");
  fallbackLink.href = subUrl;
  fallbackText.style.display = "block";
  fallbackLink.style.display = "inline";

  // Store —Å—Å—ã–ª–∫–∞
  if(storeLink) {
    const storeBlock = document.getElementById("store-link");
    const storeUrl = document.getElementById("store-url");
    storeUrl.href = storeLink;
    storeBlock.style.display = "block";
  }

  // –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥
  setTimeout(() => {
    window.location.href = deepLink;
  }, 500);

</script>

</body>
</html>
